rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // 프로필 이미지 - 모든 사용자 읽기 가능, 본인만 쓰기/삭제 가능
    match /profileImages/{userId}/{allPaths=**} {
      allow read: if true;  // 프로필 이미지는 누구나 볼 수 있음
      allow write: if request.auth != null && request.auth.uid == userId;
      allow delete: if request.auth != null && request.auth.uid == userId;
    }
    
    // 레슨 자료 - 인증된 사용자는 읽기 가능, 인증된 사용자만 쓰기 가능
    // 참고: 관리자 권한 체크는 클라이언트 코드나 Cloud Functions에서 처리해야 합니다
    match /lessonMaterials/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
      allow delete: if request.auth != null;
    }
    
    // 기타 파일들 - 기본적으로 인증된 사용자만 접근 가능
    match /{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
  }
}

